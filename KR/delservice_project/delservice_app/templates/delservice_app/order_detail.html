{% extends 'delservice_app/base.html' %}

{% block title %}–ó–∞–∫–∞–∑ ‚Ññ{{ order.id }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2">üì¶ –ó–∞–∫–∞–∑ ‚Ññ{{ order.id }}</h1>
    <a href="{% url 'delservice_app:order_update' order.id %}" class="btn btn-warning">
        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
    </a>
    <a href="{% url 'delservice_app:order_add_item' order.id %}" class="btn btn-success">
        ‚úö –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
    </a>
</div>

<div class="row mb-4">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header bg-light">
                <h5 class="mb-0">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>–°—Ç–∞—Ç—É—Å:</strong>
                            <span class="status-badge status-{{ order.status.code|lower }}">
                                {{ order.status.name }}
                            </span>
                        </p>
                        <p><strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong> {{ order.created_at|date:"d.m.Y H:i" }}</p>
                        <p><strong>–î–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:</strong>
                            {% if order.confirmed_at %}{{ order.confirmed_at|date:"d.m.Y H:i" }}{% else %}‚Äî{% endif %}
                        </p>
                        <p><strong>–î–∞—Ç–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä–∞:</strong>
                            {% if order.courier_assigned_at %}{{ order.courier_assigned_at|date:"d.m.Y H:i" }}{% else %}‚Äî{% endif %}
                        </p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>–ö–ª–∏–µ–Ω—Ç:</strong> {{ order.client.full_name }}</p>
                        <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ order.client.phone }}</p>
                        <p><strong>Email:</strong> {{ order.client.email }}</p>
                        <p><strong>–ö—É—Ä—å–µ—Ä:</strong>
                            {% if order.courier %}{{ order.courier.full_name }}{% else %}–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω{% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-light">
                <h5 class="mb-0">–ê–¥—Ä–µ—Å–∞</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="mb-2">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</h6>
                        <p>{{ order.delivery_address.street }}, {{ order.delivery_address.house_number }}{% if order.delivery_address.apartment_number %}, –∫–≤. {{ order.delivery_address.apartment_number }}{% endif %}</p>
                        {% if order.delivery_address.entrance %}<p>–ü–æ–¥—ä–µ–∑–¥: {{ order.delivery_address.entrance }}</p>{% endif %}
                        {% if order.delivery_address.floor %}<p>–≠—Ç–∞–∂: {{ order.delivery_address.floor }}</p>{% endif %}
                        {% if order.delivery_address.door_code %}<p>–ö–æ–¥ –¥–æ–º–æ—Ñ–æ–Ω–∞: {{ order.delivery_address.door_code }}</p>{% endif %}
                    </div>
                    <div class="col-md-6">
                        <h6 class="mb-2">–ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–∫–∏</h6>
                        {% if order.pickup_address %}
                        <p>{{ order.pickup_address.street }}, {{ order.pickup_address.house_number }}{% if order.pickup_address.apartment_number %}, –∫–≤. {{ order.pickup_address.apartment_number }}{% endif %}</p>
                        {% else %}
                        <p>–ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–µ —É–∫–∞–∑–∞–Ω</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header bg-light">
                <h5 class="mb-0">–¢–æ–≤–∞—Ä—ã</h5>
            </div>
            <div class="card-body">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>–¢–æ–≤–∞—Ä</th>
                            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                            <th>–¶–µ–Ω–∞</th>
                            <th>–°—É–º–º–∞</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in items %}
                        <tr>
                            <td>{{ item.product.name }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>{{ item.price_at_order }} ‚ÇΩ</td>
                            <td>{{ item.total_price }} ‚ÇΩ</td>
                            <td>
                                <a href="{% url 'delservice_app:order_item_delete' item.id %}" class="btn btn-sm btn-danger">
                                    ‚ùå
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center text-muted">–¢–æ–≤–∞—Ä—ã –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr>
                            <th colspan="3">–ò—Ç–æ–≥–æ:</th>
                            <td><strong>{{ order.order_total }} ‚ÇΩ</strong></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-light">
                <h5 class="mb-0">–§–∏–Ω–∞–Ω—Å—ã</h5>
            </div>
            <div class="card-body">
                <p><strong>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</strong> {{ order.payment_method.name }}</p>
                <p><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> {{ order.delivery_cost }} ‚ÇΩ</p>
                <p><strong>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–∫–∞–∑–∞:</strong> <strong>{{ order.order_total }} ‚ÇΩ</strong></p>
                
                {% if payment %}
                <div class="mt-3">
                    <h6 class="mb-2">–û–ø–ª–∞—Ç–∞</h6>
                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> {{ payment.status }}</p>
                    <p><strong>–°—É–º–º–∞:</strong> {{ payment.amount }} ‚ÇΩ</p>
                    <p><strong>–î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã:</strong> {{ payment.paid_at|date:"d.m.Y H:i" }}</p>
                    {% if payment.transaction_number %}
                    <p><strong>–ù–æ–º–µ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:</strong> {{ payment.transaction_number }}</p>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
        
        {% if review %}
        <div class="card">
            <div class="card-header bg-light">
                <h5 class="mb-0">–û—Ç–∑—ã–≤</h5>
            </div>
            <div class="card-body">
                <p><strong>–†–µ–π—Ç–∏–Ω–≥:</strong> {{ review.rating }} –∏–∑ 5</p>
                <p><strong>–¢–µ–∫—Å—Ç:</strong> {{ review.text|default:"–û—Ç–∑—ã–≤ –Ω–µ –æ—Å—Ç–∞–≤–ª–µ–Ω" }}</p>
                <p><strong>–î–∞—Ç–∞:</strong> {{ review.created_at|date:"d.m.Y H:i" }}</p>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}